{% extends '::base.html.twig' %}
{% block body -%}
<div class="row">
    {% for entity in entities %}
    <div class="col-lg-4">
        <div class="panel panel-default ">
            <div class="panel-heading">
                <h3 class="panel-title"><a href="{{ path('_show', { 'id': entity.id }) }}">{{ entity.title }}</a></h3>
            </div>
            <div class="panel-body" style="padding-bottom:5px">
                <blockquote>
                    {{ entity.description }}
                </blockquote>
                {# obliczanie Å›redniej oceny recenzentow #}
                {% set sumratings = 0 %}
                {% for review in entity.reviews %}
                  {% set sumratings = sumratings + review.rating %}
                {% endfor %}
                <div style="padding-bottom:-10px">
                    <div class="col-xs-2" style="padding:0px"><strong>${{ entity.price }}</strong></div>
                    <div class="col-xs-7" style="padding:0px;">Ocena: recenzentow: <strong>{{ (sumratings/entity.reviews|length)|round }}</strong></div>
                    <div class="col-xs-3" style="padding:0px;">Redakcji: <strong>{{ entity.rating }}</strong></div>
                </div>
            </div>
            <div class="panel-footer">
                <div class="coll-md-12">
                    <a  class="btn btn-info" href="{{ path('review_show', { 'id': entity.id }) }}" data-target="#myModal">Pokaz opinie ({{ entity.reviews|length }}) <i class="glyphicon glyphicon-eye-open"  ></i></a>


                    <a class="btn btn-success" href="{{ path('purchase_new', { 'id': entity.id }) }}" style="position: relative;right: -30%;">Kup <i class="glyphicon glyphicon-shopping-cart" ></i></a>
                </div>
            </div>
        </div>


    </div>
    {% endfor %}

</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                 <h4 class="modal-title">Recenzje</h4>

            </div>
            <div class="modal-body" style="padding-top: 0px"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>


{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $("a[data-target=#myModal]").click(function(ev) {
            ev.preventDefault();
            var target = $(this).attr("href");

            // load the url and show modal on success
            $("#myModal .modal-body").load(target, function() { 
                 $("#myModal").modal("show"); 
            });
        });

    </script>
{% endblock %}